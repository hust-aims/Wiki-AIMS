# ubuntu服务器安全性维护记录

## 设置密码复杂度

包括密码长度（大于等于10），大写字母符号、小写字母符号、数字符号以及特殊符号

首先安装`pam`的`cracklib`包，`cracklib`能提供额外的密码检查能力

使用下面命令安装`cracklib`包：

```sh
sudo apt install libpam-cracklib
```

之后在`/etc/pam.d/common-password`文件中修改以下参数

![](_v_images/20220509164554165_23360.png =1000x)

![](_v_images/20220509164622765_21481.png =1000x)

![](_v_images/20220509164639876_7967.png =1000x)

对上面图中一些参数的说明：

1. `retry=3`表示修改密码时，用户可以因各种原因（密码与前几个重复、密码过于简单等）重试三次，三次过后密码修改失败，使用原密码；

之后要求所有用户对密码进行修改

## 防止暴力破解密码

ssh登录密码错误次数较多后，将该账号封禁一段时间

在`/etc/pam.d/common-auth`文件中添加以下参数（下图中第1点编辑的文件路径有问题，请忽略）

![](_v_images/20220509165017400_5340.png =1000x)

参数解释
- deny # 用户登录输入密码尝试次数（图中设置为3次），3次均输错密码该用户会被锁定
- unlock_time # 被锁定后，多少秒（s）自动解锁
- even_deny_root # 对root用户生效
- root_unlock_time # root 用户被锁后，多少秒（s）自动解锁

用户被无意封禁后解禁方法：

```sh
pam_tally2 -u <username> -r
```

## 用户重新设置免密登录

攻击者在攻击后，很有可能会将自己的ssh公钥加入到被入侵用户文件中，为防止该情况，需要将所有用户的ssh公钥删除，并重新生成公钥

其中ssh公钥生成以后，会存放于用户目录下`.ssh`目录中的`authorized_keys`文件中，只需要首先将该文件删除，之后用户重新生成公钥并将公钥文件名重命名为`authorized_keys`

**本文仅考虑ubuntu系统下部分安全性问题，对于其他系统或者安全性问题，可在网上进一步查询**
